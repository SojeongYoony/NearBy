<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
<script type="text/javascript">
	$(document).ready(function(){
		fnCheckSubmit();             // ëª¨ë“  í•¨ìˆ˜ í™•ì¸ í›„ ì„œë¸Œë°‹ë„˜ê¸°ê¸°
		fnbirth();                     // ìƒë…„ì›”ì¼ ì‚½ì…
		fnIdCheck();				 
		fnPwCheck();				   
		fnPwDoubleCheck();
		fnNameCheck();
		fnEmailCheck();
		fnPhoneCheck();
		fnResetBtn();
	}); 
	
	// ì„œë¸Œë°‹
	 function  fnCheckSubmit(){
	    $('#join_form').on('submit',function(event){
	      if( confirm('ê°€ì…í•˜ì‹œê² ìŠµë‹ˆê¹Œ?') == false){
	    	  event.preventDefault(); 
	          return false;
	      } else if (  id_result ==false ) {
	            event.preventDefault();  
	            return false;    
           } else if (  pw_result ==false ) {
                event.preventDefault(); 
                return false;  
            } else if ( pw_double_result ==false ) {
                event.preventDefault();  
                return false;  
            } else if (  name_result ==false ) {
                event.preventDefault();  
                return false;  
            } else if ( email_result ==false ) {
                event.preventDefault();
                return false;  
            }else if (  phone_result ==false ) {
               event.preventDefault(); 
               return false;  
            } else 
            	return true;
	        });
	    } //   function fnCheckSubmit()
	    
	
	// ìƒë…„ì›”ì¼ ì‚½ì…
	function fnbirth(){
		let year = '';
		year +=  '<option value="year">ë…„ë„</option>';
		for(let i=2007; i>=1907; i--){
		    year += '<option value="'+i+'">'+i+'</option>';
		}
		 $('#birthday').html(year);
		
		let month = '';
		month +=  '<option value="month">ì›”</option>';
		for(let i=1; i<=12; i++){
		    month += '<option value="'+i+'">'+i+'</option>';
		}
		 $('#month').html(month);
		 
		 let day ='';
		 day += '<option value="day">ì¼</option>';
		 for(let i=1; i<=31; i++){
		     day += '<option value="'+i+'">'+i+'</option>';
		 }
		  $('#day').html(day);	 
	}
 
    // ì•„ì´ë””
     let regId = /^[a-zA-Z0-9_-]{4,}$/;
     // ë¹„ë°€ë²ˆí˜¸
     let regPwd = /^[a-zA-Z0-9!@$%^&*()]{8,20}$/;
     // ì´ë¦„
     let regName = /^[a-zA-Zê°€-í£]{1,30}$/;
     // ì´ë©”ì¼
      let regEmail = /^[0-9a-zA-Z-_]+@[a-zA-Z0-9]+([.][a-zA-Z]{2,}){1,2}/;
      // í•¸ë“œí° ë²ˆí˜¸
      let regPhone = /^((01[1|6|7|8|9])[1-9]+[0-9]{6,7})|(010[1-9][0-9]{7})$/;
      let id_result = false;
      let pw_result = false;
      let pw_double_result = false;
      let name_result = false;
      let email_result = false;
      let phone_result = false; 
   
      
      function fnIdCheck(){   
            
            $("#id").on('keyup blur',function(){
            	if ( regId.test($(this).val()) == false ) {
    				$('#id_check').text("ì•„ì´ë””ëŠ” ì†Œë¬¸ì/ìˆ«ì 4ì ì´ìƒ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.").addClass('error_msg').removeClass('pass_msg');
    				id_result = false;
    				return;
    			  }
				$.ajax({
					url : '/nearby/member/idCheck',
					type : 'post',
					data : 'id=' + $('#id').val(),
					dataType: 'json',               // ë°›ì•„ì˜¬ ë°ì´í„° íƒ€ì…
					success : function(resData){
						 if( resData.result == null){
							 $('#id_check').text('ì‚¬ìš© ê°€ëŠ¥í•œ ì•„ì´ë””').addClass("pass_msg").removeClass('error_msg');
							 id_result = true;
						 } else if($('#id').val() == '' ){
							 $('#id_check').text('ì…ë ¥ í•„ìˆ˜ì…ë‹ˆë‹¤.').addClass('error_msg').removeClass('pass_msg');;
			                    id_result = false;
			             } else if(resData.result != null) {
							 $('#id_check').text('ì´ë¯¸ ì‚¬ìš©ì¤‘ì¸ ì•„ì´ë””').addClass('error_msg').removeClass('pass_msg');;
							 id_result = false;
						 }
					},
					error : function(xhr, ajaxOptions, thrownError) {
				       alert(xhr.responseText);
				//		console.log(xhr.status);
				  //      console.log(thrownError);
					}
					
				}) // ajax
				 console.log("id: "+id_result);
				  return id_result;	 
			}); // id
    } // fnId
        
      // ë¹„ë°€ë²ˆí˜¸ ì •ê·œì‹ 
      function fnPwCheck(){
         
         $('#pw').on('blur keyup', function(){
            if( regPwd.test( $("#pw").val())){    
                $("#pw_check").text("ì‚¬ìš©ê°€ëŠ¥í•œ ë¹„ë°€ë²ˆí˜¸ì…ë‹ˆë‹¤.").addClass("pass_msg").removeClass('error_msg');
                pw_result = true;
            } else if (    $('#pw').val() == '' ){
                $("#pw_check").text('ì…ë ¥ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.').addClass('error_msg').removeClass('pass_msg');
                pw_result = false;
            }    else {
                $("#pw_check").text("ë¹„ë°€ë²ˆí˜¸ëŠ” 8~20ìì˜ ì˜ë¬¸ ëŒ€/ì†Œë¬¸ì, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ì ë“± 3ì¢…ë¥˜ ì´ìƒìœ¼ë¡œ ì¡°í•©í•´ì£¼ì„¸ìš”.").addClass('error_msg').removeClass('pass_msg');
                pw_result = false;
            }
         console.log("pw: "+pw_result);
            return pw_result;
         }); 
      
      } // fnPwCheck
      
   // ë¹„ë°€ë²ˆí˜¸ ì¬í™•ì¸ ì¼ì¹˜ 
         function fnPwDoubleCheck(){
          
          $('#pwCheck').on('blur keyup', function(){     
                if($('#pw').val() !=  $("#pwCheck").val() ){
                    $("#pw_doubleCheck").text( 'ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.').addClass('error_msg').removeClass('pass_msg');
                    pw_double_result = false;
                } else{
                    $("#pw_doubleCheck").text('').removeClass('error_msg').removeClass('pass_msg');
                    pw_double_result = true;
                }  
          console.log("pw2 : "+pw_double_result);
          return pw_double_result;
            });
      }
          
      // ì´ë¦„ ì •ê·œì‹
        function fnNameCheck() {  
           $('#name').on('blur', function(){
               if( regName.test( $(this).val())){    
                 $('#name_check').text('');
                 $('#name_check').removeClass('error_msg');
                 name_result = true;
               } else if ( $('#name').val() == '' ){
                   $('#name_check').text('ì´ë¦„ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.').addClass('error_msg').removeClass('pass_msg');
                   name_result = false;
               }  else if( regName.test( $(this).val()) == false){    
                   $('#name_check').text('ì˜ëª»ëœ ì´ë¦„ í˜•ì‹ì…ë‹ˆë‹¤.').addClass('error_msg').removeClass('pass_msg'); 
                   name_result = false;
               }
           console.log(name_result);
               return name_result;
           });
         
          } // fnName
          
        // ì´ë©”ì¼    
      function  fnEmailCheck(){
         $('#email').on('blur', function(){
                  if( regEmail.test( $('#email').val())){    
                    
                      $.ajax({
      					url : '/nearby/member/selectByEmail',
      					type : 'post',
      					data : 'email=' + $('#email').val(),
      					dataType: 'json',               // ë°›ì•„ì˜¬ ë°ì´í„° íƒ€ì…
      					success : function(resData){
      					 if(resData.result == null) {
      						  $('#email_check').text('ì‚¬ìš© ê°€ëŠ¥í•œ ì´ë©”ì¼ì…ë‹ˆë‹¤.').addClass('pass_msg').removeClass('error_msg');
                        	   email_result = true;
                        	   fnSendAuthCode();
                        	   return;
      					 } else if(resData.result != null) {
      			            	 $('#email_check').text('ì´ë¯¸ ì‚¬ìš©ì¤‘ì¸ ì´ë©”ì¼ì…ë‹ˆë‹¤.').addClass('error_msg').removeClass('pass_msg');
      							 email_result = false;
      						 }
      					},
      					error : function(xhr, ajaxOptions, thrownError) {
      				       alert(xhr.responseText);
      					}
      				}) // ajax
                   
                   } else if( $('#email').val() ==''  ) {
                	   $('#email_check').text('ì´ë©”ì¼ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.').addClass('error_msg').removeClass('pass_msg');
                   } else{
                       $('#email_check').text('ì˜ëª»ëœ ì´ë©”ì¼ í˜•ì‹ì…ë‹ˆë‹¤.').addClass('error_msg').removeClass('pass_msg');
                       email_result = false;
                  }
                  return email_result;
           });
         } // fnEmail
         
         function fnSendAuthCode(){
         	
         	$('#authCode_btn').click(function(){
         		$.ajax({
         			url : '/nearby/member/sendAuthCode',
         			type: 'post',
         			data: 'email='+ $('#email').val(),
         			dataType: 'json',
         			success : function(map) {
         				alert('ì¸ì¦ì½”ë“œê°€ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
         				fnVerifyAuthcode(map.authCode); // 12/13ì¶”ê°€ğŸ˜˜
         				alert(map.authCode);
         			},
         			error: function() {
     					alert('ì¸ì¦ì½”ë“œ ì „ì†¡ ì‹¤íŒ¨');
     				}
         		});	 // ajax
         	});
         	return;
         }
         
     	// ì¸ì¦ì½”ë“œ ê²€ì¦ ë³€ìˆ˜ì™€ í•¨ìˆ˜
      	let authCodePass = false;
      	function fnVerifyAuthcode(authCode){
      		$('#verify_btn').click(function(){
      			if ( $('#authCode').val() == authCode ) {
      				alert('ì¸ì¦ë˜ì—ˆìŠµë‹ˆë‹¤.');
      				authCodePass = true;
      			} else {
      				alert('ì¸ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      				authCodePass = false;
      			}
      			
      		}); // end click
      	}         
         

         
     
          // í•¸ë“œí°
      function	fnPhoneCheck() {
           $('#phone').on('blur', function(){
               if( regPhone.test( $('#phone').val())){    
                   $('#phone_check').text('');
                   $('#phone_check').removeClass('error_msg');
                   phone_result = true;
               } else if ($('#phone').val() == '' ){
                   $('#phone_check').text('í•¸ë“œí°ë²ˆí˜¸ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.');
                   $('#phone_check').addClass('error_msg');
                   phone_result = false;
               } else {
                   $('#phone_check').text('ì˜ëª»ëœ í˜•ì‹ì…ë‹ˆë‹¤.');
                   $('#phone_check').addClass('error_msg');
                   phone_result = false;
               }
               return phone_result;
           });
    }  // fnPhone
    
  
    
  // reset_btn í´ë¦­ì‹œ msg ì—†ì• ê¸°
  function fnResetBtn(){
    $('#reset_btn').on('click',function(){
    	$('#id_check').text('');
    	$('#pw_check').text('');
    	$('#pw_double_check').text('');
    	$('#name_check').text('');
    	$('#email_check').text('');
    	$('#phone_check').text('');
    })
   }
</script>
<style type="text/css">
   .error_msg {
   	font-size:13px;
   	color:red;
   }
   .pass_msg {
   	font-size:13px;
   	color:grey;
   }

</style>
</head>
<body>
 <!-- ë ˆì´ì•„ì›ƒ header ì‚½ì…í•˜ê¸° -->
 
 
   <h2>íšŒì›ê°€ì… í˜ì´ì§€</h2>
	<form action="/nearby/member/insertMember" method="post" id="join_form">
	<div>
		<label for="id">ì•„ì´ë””</label><input type="text" id="id" name="id">
		<span id="id_check"></span>
	</div>
	<div>
		<label for="pw">ë¹„ë°€ë²ˆí˜¸</label><input type="text" id="pw" name="pw">
		<span id="pw_check"></span>
	</div>
	<div>
		<label for="pw">ë¹„ë°€ë²ˆí˜¸ ì¬í™•ì¸</label><input type="text" id="pwCheck" >
		<span id="pw_doubleCheck"></span>
	</div>
	<div>
		<label for="name">ì´ë¦„</label><input type="text" id="name" name="name">
		<span id="name_check"></span>
	</div>
	<div>
		<label for="email">ì´ë©”ì¼</label><input type="text" id="email" name="email" >
		<input type="button" value="ì¸ì¦ë²ˆí˜¸ë°›ê¸°" id="authCode_btn"><br>
		<span id="email_check"></span><br>
		<input type="text" name="authCode" id="authCode">
		<input type="button" value="ì¸ì¦í•˜ê¸°" id="verify_btn">
	</div>
	<div>
		<label for="phone">ë²ˆí˜¸</label><input type="text" id="phone" name="phone" placeholder=" -í‘œì‹œ ì—†ì´ ì…ë ¥í•´ì£¼ì„¸ìš”">
		<span id="phone_check"></span>
	</div>
	<div>
		<label for="birthday">ìƒë…„ì›”ì¼</label>
		 <select id="birthday" name="year">
		 	
		 </select>
		  <select id="month" name="month">
		 	<option value="ì›”"></option>
		 </select>
		  <select id="day" name="day">
		 	<option value="ì¼"></option>
		 </select>
	</div>
		<div>		
		 <p id="gender_box">ì„±ë³„</p>
		  <input type="radio" name="gender" value="f" id="female" checked>
                        <label id="f" for="female">ì—¬ì„±</label>
          <input type="radio" name="gender" value="m" id="male">
                        <label id="m"  for="male">ë‚¨ì„±</label>
          <input type="radio" name="gender" value="n" id="n">
                        <label id="n"  for="n">ì„ íƒì•ˆí•¨</label>
        </div>
        <div id="join_btn_wrap">
  	      <button class="btn btn-primary">íšŒì›ê°€ì…</button>                 
       	  <input type="reset" value="ë‹¤ì‹œì‘ì„±" id="reset" class="reset">                
        </div>                
	</form>

</body>
</html>